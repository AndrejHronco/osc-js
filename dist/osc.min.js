/*! osc-js - v0.0.1 - 2014-03-18 by marmorkuchen.net */
!function(a){"use strict";function b(a){var b="";return"object"==typeof a?b="/"+a.join("/"):(b=a,b.length>1&&"/"===b[b.length-1]&&(b=b.slice(0,b.length-1))),b}function c(a){var b;return b=a.replace(/\./g,"\\."),b=b.replace(/\(/g,"\\("),b=b.replace(/\)/g,"\\)"),b=b.replace(/\{/g,"("),b=b.replace(/\}/g,")"),b=b.replace(/\,/g,"|"),b=b.replace(/\[\!/g,"[^"),b=b.replace(/\?/g,"."),b=b.replace(/\*/g,".*")}var d={SOCKET:{IS_NOT_INITALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3}},e={discardLateMessages:!1},f=function(){return this._callbackHandlers={open:[],error:[],close:[]},this._addressHandlers={},this._uuid=-1,!0};f.prototype.on=function(a,c){var d,e,f,g;if("string"!=typeof a&&"object"!=typeof a||"function"!=typeof c)throw"OSCEventHandler Error: on expects string/array as eventName and function as callback";if(d=(++this._uuid).toString(),f={token:d,callback:c},"string"==typeof a&&a in this._callbackHandlers)return this._callbackHandlers[a].push(f),d;if(e=b(a),g=new RegExp(/[#*\s\[\],\/{}|\?]/g),g.test(e.split("/").join("")))throw"OSCEventHandler Error: address string contains invalid characters";return e in this._addressHandlers||(this._addressHandlers[e]=[]),this._addressHandlers[e].push(f),d},f.prototype.off=function(a,c){var d,e,f;if("string"!=typeof a&&"object"!=typeof a||!c)throw"OSCEventHandler Error: off expects string/array as eventName and a proper token";return e=!1,"string"==typeof a&&this._callbackHandlers[a]?(f=this._callbackHandlers,d=a):(d=b(a),f=this._addressHandlers),d in f&&f[d].forEach(function(a,b){a.token===c&&(f[d].splice(b,1),e=!0)}),e},f.prototype.notify=function(a,d){var e,f,g,h;if("string"!=typeof a)throw"OSCEventHandler Error: notify expects a string";if(this._callbackHandlers[a])return this._callbackHandlers[a].forEach(function(a){a.callback(d)}),!0;if(0===a.length||"/"!==a[0])throw"OSCEventHandler Error: notify expects a proper address starting with /";return f=Object.keys(this._addressHandlers),e=this,f.forEach(function(f){g=new RegExp(c(b(a)),"g"),h=g.test(f),h&&f.length===g.lastIndex&&e._addressHandlers[f].forEach(function(a){a.callback(d)})}),!0},f.prototype.notifyLater=function(b,c,d){var f,g,h;return h=c,h.timeStamp=d.milliseconds,f=new Date,f.getTime()>=d.milliseconds?e.discardLateMessages||this.notify(b,h):(g=this,a.setTimeout(function(){g.notify(b,h)},d.milliseconds-f.getTime())),!0};var g=function(){this._socket=null};g.prototype.server=function(a,b){if(!a||!b)throw"OSCSocket Error: missing WebSocket address or port";return this._socket=new WebSocket("ws://"+a+":"+b),this._socket.binaryType="arraybuffer",this._socket.onopen=function(a){l.notify("open",a)},this._socket.onerror=function(a){l.notify("error",a)},this._socket.onmessage=function(a){var b=new i;b.decode(a.data)},!0},g.prototype.status=function(){return this._socket?this._socket.readyState:d.SOCKET.IS_NOT_INITALIZED};var h={};h.OSCString=function(){this.value="",this.offset=0},h.OSCString.prototype.decode=function(a,b){for(var c,d,e,f=new Int8Array(a),g=b;f[g]&&g<f.length;)g++;if(g===f.length)throw"OSCMessage Error: malformed not ending OSC String";for(d=f.subarray(b,g),e="",c=0;c<d.length;c++)e+=String.fromCharCode(d[c]);return this.offset=4*Math.ceil((g+1)/4),this.value=e,this.offset},h.Int32=function(){this.value=0,this.offset=0},h.Int32.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getInt32(0),this.offset=b+4,this.offset},h.Float32=function(){this.value=0,this.offset=0},h.Float32.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getFloat32(0),this.offset=b+4,this.offset},h.OSCBlob=function(){this.value=new Blob,this.offset=0},h.OSCBlob.prototype.decode=function(a,b){var c=new DataView(a,b,4),d=c.getInt32(0),e=a.slice(b+4,b+4+d);return this.value=new Blob([e]),this.offset=b+4+d,this.offset},h.OSCTimeTag=function(){this.value="",this.seconds=0,this.fraction=0,this.offset=0,this.milliseconds=0},h.OSCTimeTag.prototype.decode=function(a,b){var c=new DataView(a,b,8);return this.seconds=c.getInt32(0),this.fraction=c.getInt32(4),this.milliseconds=1e3*this.seconds,this.value=this.seconds+""+this.fraction,this.offset=b+8,this.offset};var i=function(){return!0};i.prototype.decode=function(a,b){var c,d,e;if(a.byteLength%4!==0)throw"OSCPackage Error: byteLength has to be a multiple of four";if(c=new h.OSCString,c.decode(a,0),"#bundle"===c.value){if(e=new j,e.decode(a),b&&e.timeTag.value<b.value)throw"OSCPackage Error: timetag of enclosing bundle is past timestamp of enclosed ones";return e}return d=new k,d.decode(a),b?l.notifyLater(d.address,d.toJSON(),b):l.notify(d.address,d.toJSON()),d};var j=function(){return this._CLASS="OSCBundle",this.timeTag=new h.OSCTimeTag,this.bundleElements=[],!0};j.prototype.decode=function(a){var b,c,d,e;c=new h.OSCTimeTag,b=c.decode(a,8),this.timeTag=c;do d=new h.Int32,b=d.decode(a,b),d.value>0&&(e=new i,this.bundleElements.push(e.decode(a.slice(b,b+d.value),c))),b+=d.value;while(b<a.byteLength);return this};var k=function(){return this._CLASS="OSCMessage",this.address="",this.typesString="",this.args=[],!0};k.prototype.toJSON=function(){return{address:this.address,types:this.typesString,arguments:this.args}},k.prototype.decode=function(a){var b,c,d,e,f;if(b=new h.OSCString,b.decode(a,0),c=new h.OSCString,c.decode(a,b.offset),0===c.length||","!==c.value[0])throw"OSCMessage Error: malformed or missing OSC TypeString";for(e=[],f=c.offset,d=1;d<c.value.length;d++){var g;if("i"===c.value[d])g=new h.Int32;else if("f"===c.value[d])g=new h.Float32;else if("s"===c.value[d])g=new h.OSCString;else{if("b"!==c.value[d])throw"OSCMessage Error: found nonstandard argument type";g=new h.OSCBlob}g.decode(a,f),f=g.offset,e.push(g.value)}return this.address=b.value,this.typesString=c.value.slice(1,c.value.length),this.args=e,this},k.prototype.encode=function(a,b){return console.log(a,b),!0};var l,m,n=function(a){return a&&Object.keys(a).forEach(function(b){b in e&&(e[b]=a[b])}),this.SOCKET=d.SOCKET,l=new f,m=new g,this.__OSCEventHandler=f,this.__OSCSocket=g,this.__OSCPacket=i,this.__OSCBundle=j,this.__OSCMessage=k,!0};n.prototype.on=function(a,b){return l.on(a,b)},n.prototype.off=function(a,b){return l.off(a,b)},n.prototype.server=function(a,b){return m.server(a,b)},n.prototype.status=function(){return m.status()},a.OSC=n}(window);
//# sourceMappingURL=osc.min.map