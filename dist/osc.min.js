!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.OSC=e()}(this,function(){"use strict";function t(t){return Number(t)===t&&t%1==0}function e(t){return Number(t)===t&&t%1!=0}function n(t){return"string"==typeof t}function r(t){return"[object Array]"===Object.prototype.toString.call(t)}function o(t){return"[object Object]"===Object.prototype.toString.call(t)}function i(t){return"function"==typeof t}function s(t){return t instanceof Uint8Array}function a(t){return t instanceof Date}function u(t){return void 0===t}function c(t){return t+3&-4}function f(t){return t.buffer?new DataView(t.buffer):t instanceof ArrayBuffer?new DataView(t):new DataView(new Uint8Array(t))}function h(r){if(t(r))return"i";if(e(r))return"f";if(n(r))return"s";if(s(r))return"b";throw new Error("OSC typeTag() found unknown value type")}function l(t){var e="";if(r(t))return"/"+t.join("/");if(n(t))return e=t,e.length>1&&"/"===e[e.length-1]&&(e=e.slice(0,e.length-1)),e.length>1&&"/"!==e[0]&&(e="/"+e),e;throw new Error("OSC prepareAddress() needs addresses of type array or string")}function d(t){var e=void 0;if(!n(t))throw new Error("OSC prepareRegExPattern() needs strings");return e=t.replace(/\./g,"\\."),e=e.replace(/\(/g,"\\("),e=e.replace(/\)/g,"\\)"),e=e.replace(/\{/g,"("),e=e.replace(/\}/g,")"),e=e.replace(/,/g,"|"),e=e.replace(/\[!/g,"[^"),e=e.replace(/\?/g,"."),e=e.replace(/\*/g,".*")}function p(t,e){return Object.assign({},B,t,e,{open:Object.assign({},B.open,t.open,e.open),send:Object.assign({},B.send,t.send,e.send)})}function v(t,e){return Object.assign({},W,t,e,{udpServer:Object.assign({},W.udpServer,t.udpServer,e.udpServer),udpClient:Object.assign({},W.udpClient,t.udpClient,e.udpClient),wsServer:Object.assign({},W.wsServer,t.wsServer,e.wsServer)})}var w=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},g=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),y=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(r)},k=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},S=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},b=function(){function t(){w(this,t),this.data=[],this.byteLength=0}return g(t,[{key:"add",value:function(t){var e=t.pack();return this.byteLength+=e.byteLength,this.data.push(e),this}},{key:"merge",value:function(){var t=new Uint8Array(this.byteLength),e=0;return this.data.forEach(function(n){t.set(n,e),e+=n.byteLength}),t}}]),t}(),O=function(){function t(e){w(this,t),this.value=e,this.offset=0}return g(t,[{key:"pack",value:function(t,e){if(!t||!e)throw new Error("OSC Atomic cant't be packed without given method or byteLength");var n=new Uint8Array(e),r=new DataView(n.buffer);if(u(this.value))throw new Error("OSC Atomic cant't be encoded with empty value");return r[t](this.offset,this.value,!1),n}},{key:"unpack",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(t&&e&&n))throw new Error("OSC Atomic cant't be unpacked without given dataView, method or byteLength");if(!(t instanceof DataView))throw new Error("OSC Atomic expects an instance of type DataView");return this.value=t[e](r,!1),this.offset=r+n,this.offset}}]),t}(),m=function(e){function n(e){if(w(this,n),e&&!t(e))throw new Error("OSC AtomicInt32 constructor expects value of type number");return S(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))}return k(n,e),g(n,[{key:"pack",value:function(){return y(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"pack",this).call(this,"setInt32",4)}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"unpack",this).call(this,t,"getInt32",4,e)}}]),n}(O),E=function(t){function n(t){if(w(this,n),t&&!e(t))throw new Error("OSC AtomicFloat32 constructor expects value of type float");return S(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t))}return k(n,t),g(n,[{key:"pack",value:function(){return y(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"pack",this).call(this,"setFloat32",4)}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return y(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"unpack",this).call(this,t,"getFloat32",4,e)}}]),n}(O),I=function(t){function e(t){if(w(this,e),t&&!n(t))throw new Error("OSC AtomicString constructor expects value of type string");return S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return k(e,t),g(e,[{key:"pack",value:function(){if(u(this.value))throw new Error("OSC AtomicString can not be encoded with empty value");for(var t=this.value+"\0",e=c(t.length),n=new Uint8Array(e),r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC AtomicString expects an instance of type DataView");for(var n=e,r=void 0,o=[];n<t.byteLength;n+=1){if(0===(r=t.getUint8(n))){n+=1;break}o.push(r)}if(n===t.length)throw new Error("OSC AtomicString found a malformed OSC string");return this.offset=c(n),this.value=String.fromCharCode.apply(null,o),this.offset}}]),e}(O),C=function(t){function e(t){if(w(this,e),t&&!s(t))throw new Error("OSC AtomicBlob constructor expects value of type Uint8Array");return S(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return k(e,t),g(e,[{key:"pack",value:function(){if(u(this.value))throw new Error("OSC AtomicBlob can not be encoded with empty value");var t=c(this.value.byteLength),e=new Uint8Array(t+4);return new DataView(e.buffer).setInt32(0,this.value.byteLength,!1),e.set(this.value,4),e}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC AtomicBlob expects an instance of type DataView");var n=t.getInt32(e,!1);return this.value=new Uint8Array(t.buffer,e+4,n),this.offset=c(e+4+n),this.offset}}]),e}(O),_=function(){function o(){w(this,o),this.offset=0,this.address="",this.types="",this.args=[];for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];if(e.length>0){if(!n(e[0])&&!r(e[0]))throw new Error("OSC Message constructor first argument (address) must be a string or array");this.address=l(e.shift()),this.types=e.map(function(t){return h(t)}).join(""),this.args=e}}return g(o,[{key:"add",value:function(t){if(!t)throw new Error("OSC Message needs a valid OSC Atomic Data Type");this.args.push(t),this.types+=h(t)}},{key:"pack",value:function(){if(0===this.address.length||"/"!==this.address[0])throw new Error("OSC Message has an invalid address");var r=new b;if(r.add(new I(this.address)),r.add(new I(","+this.types)),this.args.length>0){var o=void 0;this.args.forEach(function(i){if(t(i))o=new m(i);else if(e(i))o=new E(i);else if(n(i))o=new I(i);else{if(!s(i))throw new Error("OSC Message found unknown argument type");o=new C(i)}r.add(o)})}return r.merge()}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Message expects an instance of type DataView.");var n=new I;n.unpack(t,e);var r=new I;if(r.unpack(t,n.offset),0===n.value.length||"/"!==n.value[0])throw new Error("OSC Message found malformed or missing address string");if(0===r.value.length&&","!==r.value[0])throw new Error("OSC Message found malformed or missing type string");for(var o=r.offset,i=void 0,s=void 0,a=[],u=1;u<r.value.length;u+=1){if("i"===(s=r.value[u]))i=new m;else if("f"===s)i=new E;else if("s"===s)i=new I;else{if("b"!==s)throw new Error("OSC Message found non-standard argument type");i=new C}o=i.unpack(t,o),a.push(i.value)}return this.offset=o,this.address=n.value,this.types=r.value,this.args=a,this.offset}}]),o}(),N=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(w(this,e),!t(n)||!t(r))throw new Error("OSC Timetag constructor expects values of type integer number");this.seconds=n,this.fractions=r}return g(e,[{key:"timestamp",value:function(t){var e=void 0;if("number"==typeof t){e=t/1e3;var n=Math.floor(e);return this.seconds=n+2208988800,this.fractions=Math.round(4294967296*(e-n)),t}return 1e3*((e=this.seconds-2208988800)+this.fractions/4294967296)}}]),e}(),P=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();w(this,n);var r=new N;return e instanceof N?r=e:t(e)?r.timestamp(e):a(e)&&r.timestamp(e.getTime()),S(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,r))}return k(n,e),g(n,[{key:"pack",value:function(){if(u(this.value))throw new Error("OSC AtomicTimetag can not be encoded with empty value");var t=this.value,e=t.seconds,n=t.fractions,r=new Uint8Array(8),o=new DataView(r.buffer);return o.setInt32(0,e,!1),o.setInt32(4,n,!1),r}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC AtomicTimetag expects an instance of type DataView");var n=t.getUint32(e,!1),r=t.getUint32(e+4,!1);return this.value=new N(n,r),this.offset=e+8,this.offset}}]),n}(O),D=function(){function e(){var n=this;w(this,e),this.offset=0,this.timetag=new P,this.bundleElements=[];for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];i.length>0&&(i[0]instanceof Date||t(i[0])?this.timetag=new P(i[0]):r(i[0])?(i[0].forEach(function(t){n.add(t)}),i.length>1&&(i[1]instanceof Date||t(i[0]))&&(this.timetag=new P(i[1]))):i.forEach(function(t){n.add(t)}))}return g(e,[{key:"timestamp",value:function(e){if(!t(e))throw new Error("OSC Bundle needs an integer for setting the timestamp");this.timetag=new P(e)}},{key:"add",value:function(t){if(!(t instanceof _||t instanceof e))throw new Error("OSC Bundle contains only Messages and Bundles");this.bundleElements.push(t)}},{key:"pack",value:function(){var t=new b;return t.add(new I("#bundle")),this.timetag||(this.timetag=new P),t.add(this.timetag),this.bundleElements.forEach(function(e){t.add(new m(e.pack().byteLength)),t.add(e)}),t.merge()}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Bundle expects an instance of type DataView");var n=new I;if(n.unpack(t,e),"#bundle"!==n.value)throw new Error("OSC Bundle does not contain a valid #bundle head");var r=new P,o=r.unpack(t,n.offset);for(this.bundleElements=[];o<t.byteLength;){var i=new A;o=(new m).unpack(t,o),o=i.unpack(t,o,this.timetag),this.bundleElements.push(i.value)}return this.offset=o,this.timetag=r,this.offset}}]),e}(),A=function(){function t(e){if(w(this,t),e&&!(e instanceof _||e instanceof D))throw new Error("OSC Packet value has to be Message or Bundle");this.value=e,this.offset=0}return g(t,[{key:"pack",value:function(){if(!this.value)throw new Error("OSC Packet can not be encoded with empty body");return this.value.pack()}},{key:"unpack",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!(t instanceof DataView))throw new Error("OSC Packet expects an instance of type DataView");if(t.byteLength%4!=0)throw new Error("OSC Packet byteLength has to be a multiple of four");var n=new I;n.unpack(t,e);var r=void 0;return r="#bundle"===n.value?new D:new _,r.unpack(t,e),this.offset=r.offset,this.value=r,this.offset}}]),t}(),L={discardLateMessages:!1},j=function(){function e(t){w(this,e),this.options=Object.assign({},L,t),this.addressHandlers=[],this.eventHandlers={open:[],error:[],close:[]},this.uuid=0}return g(e,[{key:"dispatch",value:function(t){var e=this;if(!(t instanceof A))throw new Error("OSC EventHander dispatch() accepts only arguments of type Packet");if(!t.value)throw new Error("OSC EventHander dispatch() can't read empty Packets");if(t.value instanceof D){var n=t.value;return n.bundleElements.forEach(function(r){if(t.value instanceof D){if(n.timetag.value.timestamp()<r.timetag.value.timestamp())throw new Error("OSC Bundle timestamp is older than the timestamp of enclosed Bundles");return e.dispatch(r)}if(r instanceof _){var o=r;return e.notify(o.address,o,n.timetag.value.timestamp())}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")})}if(t.value instanceof _){var r=t.value;return this.notify(r.address,r)}throw new Error("OSC EventHander dispatch() can't dispatch unknown Packet value")}},{key:"call",value:function(t,e){var r=!1;if(n(t)&&t in this.eventHandlers)return this.eventHandlers[t].forEach(function(t){t.callback(e),r=!0}),r;var o=Object.keys(this.addressHandlers),i=this.addressHandlers;return o.forEach(function(n){var o=new RegExp(d(l(t)),"g");o.test(n)&&n.length===o.lastIndex&&i[n].forEach(function(t){t.callback(e),r=!0})}),r}},{key:"notify",value:function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];if(0===r.length)throw new Error("OSC EventHandler can not be called without any argument");if(r[0]instanceof A)return this.dispatch(r[0]);if(r[0]instanceof D||r[0]instanceof _)return this.dispatch(new A(r[0]));if(!n(r[0])){var i=new A;return i.unpack(f(r[0])),this.dispatch(i)}var s=r[0],a=null;r.length>1&&(a=r[1]);var u=null;if(r.length>2)if(t(r[2]))u=r[2];else{if(!(r[2]instanceof Date))throw new Error("OSC EventHandler timestamp has to be a number or Date");u=r[2].getTime()}if(u){var c=Date.now();if(c>u&&!this.options.discardLateMessages)return this.call(s,a);var h=this;return setTimeout(function(){h.call(s,a)},u-c),!0}return this.call(s,a)}},{key:"on",value:function(t,e){if(!n(t)&&!r(t))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!i(e))throw new Error("OSC EventHandler callback has to be a function");this.uuid+=1;var o={id:this.uuid,callback:e};if(n(t)&&t in this.eventHandlers)return this.eventHandlers[t].push(o),this.uuid;var s=l(t);if(new RegExp(/[#*\s[\],\/{}|?]/g).test(s.split("/").join("")))throw new Error("OSC EventHandler address string contains invalid characters");return s in this.addressHandlers||(this.addressHandlers[s]=[]),this.addressHandlers[s].push(o),this.uuid}},{key:"off",value:function(e,o){if(!n(e)&&!r(e))throw new Error("OSC EventHandler accepts only strings or arrays for address patterns");if(!t(o))throw new Error("OSC EventHandler subscription id has to be a number");var i=void 0,s=void 0;return n(e)&&e in this.eventHandlers?(i=e,s=this.eventHandlers):(i=l(e),s=this.addressHandlers),i in s&&s[i].some(function(t,e){return t.id===o&&(s[i].splice(e,1),!0)})}}]),e}(),T="undefined"!=typeof __dirname?require("dgram"):void 0,H={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},x={host:"localhost",port:41234,exclusive:!1},V={host:"localhost",port:41235},B={type:"udp4",open:x,send:V},M=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(w(this,t),!T)throw new Error("DatagramPlugin can not be used in browser context");this.options=p({},n),this.socket=T.createSocket(this.options.type),this.socketStatus=H.IS_NOT_INITIALIZED,this.socket.on("message",function(t){e.notify(t)}),this.socket.on("error",function(t){e.notify("error",t)}),this.notify=function(){}}return g(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},this.options.open,e),r=n.port,o=n.exclusive;this.socketStatus=H.IS_CONNECTING,this.socket.bind({address:n.host,port:r,exclusive:o},function(){t.socketStatus=H.IS_OPEN,t.notify("open")})}},{key:"close",value:function(){var t=this;this.socketStatus=H.IS_CLOSING,this.socket.close(function(){t.socketStatus=H.IS_CLOSED,t.notify("close")})}},{key:"send",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object.assign({},this.options.send,e),r=n.port,o=n.host;this.socket.send(new Buffer(t),0,t.byteLength,r,o)}}]),t}(),G="undefined"!=typeof __dirname?require("dgram"):void 0,U="undefined"!=typeof __dirname?require("ws").Server:void 0,Z={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},W={udpServer:{host:"localhost",port:41234,exclusive:!1},udpClient:{host:"localhost",port:41235},wsServer:{host:"localhost",port:8080},receiver:"ws"},q=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(w(this,t),!G||!U)throw new Error("BridgePlugin can not be used in browser context");this.options=v({},n),this.websocket=null,this.socket=G.createSocket("udp4"),this.socketStatus=Z.IS_NOT_INITIALIZED,this.socket.on("message",function(t){e.send(t,{receiver:"ws"}),e.notify(t.buffer)}),this.socket.on("error",function(t){e.notify("error",t)}),this.notify=function(){}}return g(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=v(this.options,e);this.socketStatus=Z.IS_CONNECTING,this.socket.bind({address:n.udpServer.host,port:n.udpServer.port,exclusive:n.udpServer.exclusive},function(){t.websocket=new U({host:n.wsServer.host,port:n.wsServer.port}),t.websocket.binaryType="arraybuffer",t.websocket.on("listening",function(){t.socketStatus=Z.IS_OPEN,t.notify("open")}),t.websocket.on("error",function(e){t.notify("error",e)}),t.websocket.on("connection",function(e){e.on("message",function(e){t.send(e,{receiver:"udp"}),t.notify(new Uint8Array(e))})})})}},{key:"close",value:function(){var t=this;this.socketStatus=Z.IS_CLOSING,this.socket.close(function(){t.websocket.close(function(){t.socketStatus=Z.IS_CLOSED,t.notify("close")})})}},{key:"send",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=v(this.options,e),r=n.receiver;if("udp"===r){var o=t instanceof Buffer?t:new Buffer(t);this.socket.send(o,0,o.byteLength,n.udpClient.port,n.udpClient.host)}else{if("ws"!==r)throw new Error("BridgePlugin can not send message to unknown receiver");this.websocket.clients.forEach(function(e){e.send(t,{binary:!0})})}}}]),t}(),F="undefined"==typeof __dirname?WebSocket:require("ws"),R={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},z={host:"localhost",port:8080},J=function(){function t(e){if(w(this,t),!F)throw new Error("WebsocketClientPlugin can't find a WebSocket class");this.options=Object.assign({},z,e),this.socket=null,this.socketStatus=R.IS_NOT_INITIALIZED,this.notify=function(){}}return g(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},this.options,e),r=n.port,o=n.host;this.socket&&this.close(),this.socket=new F("ws://"+o+":"+r),this.socket.binaryType="arraybuffer",this.socketStatus=R.IS_CONNECTING,this.socket.onopen=function(){t.socketStatus=R.IS_OPEN,t.notify("open")},this.socket.onclose=function(){t.socketStatus=R.IS_CLOSED,t.notify("close")},this.socket.onerror=function(e){t.notify("error",e)},this.socket.onmessage=function(e){t.notify(e.data)}}},{key:"close",value:function(){this.socketStatus=R.IS_CLOSING,this.socket.close()}},{key:"send",value:function(t){this.socket.send(t)}}]),t}(),K="undefined"!=typeof __dirname?require("ws").Server:void 0,Q={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},X={host:"localhost",port:8080},Y=function(){function t(e){if(w(this,t),!K)throw new Error("WebsocketServerPlugin can not be used in browser context");this.options=Object.assign({},X,e),this.socket=null,this.socketStatus=Q.IS_NOT_INITIALIZED,this.notify=function(){}}return g(t,[{key:"registerNotify",value:function(t){this.notify=t}},{key:"status",value:function(){return this.socketStatus}},{key:"open",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},this.options,e),r=n.port,o=n.host;this.socket&&this.close(),this.socket=new K({host:o,port:r}),this.socket.binaryType="arraybuffer",this.socketStatus=Q.IS_CONNECTING,this.socket.on("listening",function(){t.socketStatus=Q.IS_OPEN,t.notify("open")}),this.socket.on("error",function(e){t.notify("error",e)}),this.socket.on("connection",function(e){e.on("message",function(e){t.notify(new Uint8Array(e))})})}},{key:"close",value:function(){var t=this;this.socketStatus=Q.IS_CLOSING,this.socket.close(function(){t.socketStatus=Q.IS_CLOSED,t.notify("close")})}},{key:"send",value:function(t){this.socket.clients.forEach(function(e){e.send(t,{binary:!0})})}}]),t}(),$={plugin:new J,discardLateMessages:!1},tt={IS_NOT_INITIALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3},et=function(){function e(t){if(w(this,e),t&&!o(t))throw new Error("OSC options argument has to be an object.");this.options=Object.assign({},$,t),this.eventHandler=new j({discardLateMessages:this.options.discardLateMessages});var n=this.eventHandler;this.options.plugin&&this.options.plugin.registerNotify&&this.options.plugin.registerNotify(function(){return n.notify.apply(n,arguments)})}return g(e,[{key:"on",value:function(t,e){if(!n(t)||!i(e))throw new Error("OSC on() needs event- or address string and callback function");return this.eventHandler.on(t,e)}},{key:"off",value:function(e,r){if(!n(e)||!t(r))throw new Error("OSC off() needs string and number (subscriptionId) to unsubscribe");return this.eventHandler.off(e,r)}},{key:"open",value:function(t){if(t&&!o(t))throw new Error("OSC open() options argument needs to be an object");if(!this.options.plugin||!i(this.options.plugin.open))throw new Error("OSC Plugin API #open is not implemented!");return this.options.plugin.open(t)}},{key:"status",value:function(){if(!this.options.plugin||!i(this.options.plugin.status))throw new Error("OSC Plugin API #status is not implemented!");return this.options.plugin.status()}},{key:"close",value:function(){if(!this.options.plugin||!i(this.options.plugin.close))throw new Error("OSC Plugin API #close is not implemented!");return this.options.plugin.close()}},{key:"send",value:function(t,e){if(!this.options.plugin||!i(this.options.plugin.send))throw new Error("OSC Plugin API #send is not implemented!");if(!(t instanceof _||t instanceof D||t instanceof A))throw new Error("OSC send() needs Messages, Bundles or Packets");if(e&&!o(e))throw new Error("OSC send() options argument has to be an object");return this.options.plugin.send(t.pack(),e)}}]),e}();return et.STATUS=tt,et.Packet=A,et.Bundle=D,et.Message=_,et.DatagramPlugin=M,et.WebsocketClientPlugin=J,et.WebsocketServerPlugin=Y,et.BridgePlugin=q,et});
