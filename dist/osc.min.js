/*! osc-js - v0.0.1 - 2014-05-10 by marmorkuchen.net */
!function(a){"use strict";function b(a){return"[object Array]"===Object.prototype.toString.call(a)}function c(a){return"number"==typeof a&&a%1===0}function d(a){var b="";return"object"==typeof a?b="/"+a.join("/"):(b=a,b.length>1&&"/"===b[b.length-1]&&(b=b.slice(0,b.length-1)),b.length>1&&"/"!==b[0]&&(b="/"+b)),b}function e(a){var b;return b=a.replace(/\./g,"\\."),b=b.replace(/\(/g,"\\("),b=b.replace(/\)/g,"\\)"),b=b.replace(/\{/g,"("),b=b.replace(/\}/g,")"),b=b.replace(/\,/g,"|"),b=b.replace(/\[\!/g,"[^"),b=b.replace(/\?/g,"."),b=b.replace(/\*/g,".*")}var f={SOCKET:{IS_NOT_INITALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3}},g={discardLateMessages:!1},h=function(){return this._callbackHandlers={open:[],error:[],close:[]},this._addressHandlers={},this._uuid=-1,!0};h.prototype.on=function(a,c){var e,f,g,h;if("string"!=typeof a&&!b(a)||"function"!=typeof c)throw"OSCEventHandler Error: on expects string/array as eventName and function as callback";if(e=(++this._uuid).toString(),g={token:e,callback:c},"string"==typeof a&&a in this._callbackHandlers)return this._callbackHandlers[a].push(g),e;if(f=d(a),h=new RegExp(/[#*\s\[\],\/{}|\?]/g),h.test(f.split("/").join("")))throw"OSCEventHandler Error: address string contains invalid characters";return f in this._addressHandlers||(this._addressHandlers[f]=[]),this._addressHandlers[f].push(g),e},h.prototype.off=function(a,c){var e,f,g;if("string"!=typeof a&&!b(a)||!c)throw"OSCEventHandler Error: off expects string/array as eventName and a proper token";return f=!1,"string"==typeof a&&this._callbackHandlers[a]?(g=this._callbackHandlers,e=a):(e=d(a),g=this._addressHandlers),e in g&&g[e].forEach(function(a,b){a.token===c&&(g[e].splice(b,1),f=!0)}),f},h.prototype.notify=function(a,b){var c,f,g,h;if("string"!=typeof a)throw"OSCEventHandler Error: notify expects a string";if(this._callbackHandlers[a])return this._callbackHandlers[a].forEach(function(a){a.callback(b)}),!0;if(0===a.length||"/"!==a[0])throw"OSCEventHandler Error: notify expects a proper address starting with /";return f=Object.keys(this._addressHandlers),c=this,f.forEach(function(f){g=new RegExp(e(d(a)),"g"),h=g.test(f),h&&f.length===g.lastIndex&&c._addressHandlers[f].forEach(function(a){a.callback(b)})}),!0},h.prototype.notifyLater=function(b,c,d){var e,f,h;return h=c,h.timeStamp=d.milliseconds,e=new Date,e.getTime()>=d.milliseconds?g.discardLateMessages||this.notify(b,h):(f=this,a.setTimeout(function(){f.notify(b,h)},d.milliseconds-e.getTime())),!0};var i=function(){this._socket=null};i.prototype.server=function(a,b){if(!a||!b)throw"OSCSocket Error: missing WebSocket address or port";return this._socket=new WebSocket("ws://"+a+":"+b),this._socket.binaryType="arraybuffer",this._socket.onopen=function(a){n.notify("open",a)},this._socket.onerror=function(a){n.notify("error",a)},this._socket.onmessage=function(a){var b=new k;b.decode(a.data)},!0},i.prototype.status=function(){return this._socket?this._socket.readyState:f.SOCKET.IS_NOT_INITALIZED},i.prototype.send=function(a){return a?(console.log("SEND",a),this._socket.send(a.buffer),!0):!1};var j={};j.OSCString=function(a){this.value=a||"",this.offset=0},j.OSCString.prototype.decode=function(a,b){for(var c,d,e,f=new Int8Array(a),g=b;f[g]&&g<f.length;)g++;if(g===f.length)throw"OSCMessage Error: malformed not ending OSC String";for(d=f.subarray(b,g),e="",c=0;c<d.length;c++)e+=String.fromCharCode(d[c]);return this.offset=4*Math.ceil((g+1)/4),this.value=e,this.offset},j.OSCString.prototype.encode=function(){for(var a=4*Math.ceil((this.value.length+1)/4),b=new Array(a),c=0;a>c;c++)b[c]=this.value.charCodeAt(c)||0;return new Int8Array(b)},j.Int32=function(a){this.value=a||0,this.offset=0},j.Int32.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getInt32(0),this.offset=b+4,this.offset},j.Int32.prototype.encode=function(){var a=new DataView(new ArrayBuffer(4));return a.setInt32(0,this.value),new Int8Array(a.buffer)},j.Float32=function(a){this.value=a||0,this.offset=0,this.warn=function(a){console.log(a)}},j.Float32.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getFloat32(0),this.offset=b+4,this.offset},j.Float32.prototype.encode=function(){var a=new DataView(new ArrayBuffer(4));return a.setFloat32(0,this.value),new Int8Array(a.buffer)},j.OSCBlob=function(a){this.value=a||new Blob,this.offset=0},j.OSCBlob.prototype.decode=function(a,b){var c=new DataView(a,b,4),d=c.getInt32(0),e=a.slice(b+4,b+4+d);return this.value=new Blob([e]),this.offset=b+4+d,this.offset},j.OSCBlob.prototype.encode=function(){var a=4*Math.ceil((this.value.size+1)/4),b=new DataView(new ArrayBuffer(a+4));return b.setInt32(0,this.value.size),b.setInt32(4,this.value),new Int8Array(b.buffer)},j.OSCTimeTag=function(){this.value="",this.seconds=0,this.fraction=0,this.offset=0,this.milliseconds=0},j.OSCTimeTag.prototype.update=function(a){var b;b=a instanceof Date?a.getTime():a;var c=(b/1e3).toString();return this.seconds=parseInt(c.split(".")[0],10),this.fraction=parseInt(c.split(".")[1],10),this.milliseconds=b,this.value=this.seconds+"."+this.fraction,!0},j.OSCTimeTag.prototype.decode=function(a,b){var c=new DataView(a,b,8);return this.seconds=c.getInt32(0),this.fraction=c.getInt32(4),this.milliseconds=1e3*this.seconds,this.value=this.seconds+"."+this.fraction,this.offset=b+8,this.offset},j.OSCTimeTag.prototype.encode=function(){var a=new DataView(new ArrayBuffer(8));return a.setInt32(0,this.seconds),a.setInt32(4,this.fraction),new Int8Array(a.buffer)};var k=function(){return!0};k.prototype.decode=function(a,b){var c,d,e;if(a.byteLength%4!==0)throw"OSCPackage Error: byteLength has to be a multiple of four";if(c=new j.OSCString,c.decode(a,0),"#bundle"===c.value){if(e=new l,e.decode(a),b&&e.timeTag.value<b.value)throw"OSCPackage Error: timetag of enclosing bundle is past timestamp of enclosed ones";return e}return d=new m,d.decode(a),b?n.notifyLater(d.addressPattern,d,b):n.notify(d.addressPattern,d),d},k.prototype.encode=function(a){if(a instanceof m){if(0===a.address.length)throw"OSCPacket Error: cant encode OSCMessage since address is empty";return a.encode()}return a instanceof l?a.encode():!1};var l=function(){if(this.timeTag=new j.OSCTimeTag,this.bundleElements=[],arguments.length>0)if(c(arguments[0])||arguments[0]instanceof Date)this.timeTag.update(arguments[0]);else{if(!b(arguments[0]))throw"OSCBundle Error: first argument of constructor must be array of OSCMessages or TimeTag";for(var a=arguments[0].length,d=0;a>d;d++){if(!(arguments[0][d]instanceof m))throw"OSCBundle Error: argument must be an OSCMessage";this.bundleElements.push(arguments[0][d])}arguments.length>1&&(c(arguments[1])||arguments[1]instanceof Date)&&this.timeTag.update(arguments[1])}return!0};l.prototype.timestamp=function(a){if(!a)return this.timeTag;if(!(c(a)||a instanceof Date))throw"OSCBundle Error: timetag must be an integer (milliseconds) or Date instance";this.timeTag.update(a)},l.prototype.add=function(a){if(!(a&&a instanceof m))throw"OSCBundle Error: proper OSCMessage needed for bundling";this.bundleElements.push(a)},l.prototype.decode=function(a){var b,c,d,e;c=new j.OSCTimeTag,b=c.decode(a,8),this.timeTag=c;do d=new j.Int32,b=d.decode(a,b),d.value>0&&(e=new k,this.bundleElements.push(e.decode(a.slice(b,b+d.value),c))),b+=d.value;while(b<a.byteLength);return this},l.prototype.encode=function(){return this};var m=function(){var a,e;if(this.addressPattern="",this.typesString="",this.args=[],e=arguments.length,e>0){if("string"!=typeof arguments[0]&&!b(arguments[0]))throw"OSC.Message Error: first argument (path) must be a string or array";if(this.addressPattern=d(arguments[0]),e>1){var f="";for(a=1;e>a;a++){if("number"==typeof arguments[a])f+=c(arguments[a])?"i":"f";else if("string"==typeof arguments[a])f+="s";else{if(!(arguments[a]instanceof Blob))throw"OSCMessage Error: unknown argument type";f+="b"}this.args.push(arguments[a])}this.typesString=f}}return!0};m.prototype.address=function(a){if(!a)return this.addressPattern;if("string"!=typeof a&&!b(a))throw"OSC.Message Error: first argument (path) must be a string or array";this.addressPattern=d(a)},m.prototype.add=function(a){if(!a)return!1;var b;if("number"==typeof a)b=a%1===0?"i":"f";else if("string"==typeof a)b="s";else{if(!(a instanceof Blob))throw"OSCMessage Error: unknown argument type";b="b"}this.args.push(a),this.typesString=this.typesString+b},m.prototype.toJSON=function(){return{address:this.addressPattern,types:this.typesString,arguments:this.args}},m.prototype.decode=function(a){var b,c,d,e,f;if(b=new j.OSCString,b.decode(a,0),c=new j.OSCString,c.decode(a,b.offset),0===c.length||","!==c.value[0])throw"OSCMessage Error: malformed or missing OSC TypeString";for(e=[],f=c.offset,d=1;d<c.value.length;d++){var g;if("i"===c.value[d])g=new j.Int32;else if("f"===c.value[d])g=new j.Float32;else if("s"===c.value[d])g=new j.OSCString;else{if("b"!==c.value[d])throw"OSCMessage Error: found nonstandard argument type";g=new j.OSCBlob}g.decode(a,f),f=g.offset,e.push(g.value)}return this.addressPattern=b.value,this.typesString=c.value.slice(1,c.value.length),this.args=e,this},m.prototype.encode=function(){var a,b,c,d,e,f;if(a=[],c=0,0===this.addressPattern.length||"/"!==this.addressPattern[0])throw"OSCMessage Error: proper address is needed to encode this message";return e=new j.OSCString(this.addressPattern),d=e.encode(),c+=d.length,a.push(d),this.args.length>0&&(e=new j.OSCString(","+this.typesString),d=e.encode(),c+=d.length,a.push(d),this.args.forEach(function(b){if("number"==typeof b)e=b%1===0?new j.Int32(b):new j.Float32(b);else if("string"==typeof b)e=new j.OSCString(b);else{if(!(b instanceof Blob))throw"OSCMessage Error: unknown argument type";e=new j.OSCBlob(b)}d=e.encode(),c+=d.length,a.push(d)})),b=new Int8Array(c),f=0,a.forEach(function(a){b.set(a,f),f+=a.length}),b};var n,o,p=function(a){return a&&Object.keys(a).forEach(function(b){b in g&&(g[b]=a[b])}),this.SOCKET=f.SOCKET,n=new h,o=new i,!0};p.prototype.on=function(a,b){return n.on(a,b)},p.prototype.off=function(a,b){return n.off(a,b)},p.prototype.server=function(a,b){return o.server(a,b)},p.prototype.status=function(){return o.status()},p.prototype.send=function(a){if(!(a instanceof m||a instanceof l))throw"OSC Error: packet must be an OSC.Message or OSC.Bundle instance";var b=new k;return o.send(b.encode(a))},a.OSC=p,a.OSC.Message=m,a.OSC.Bundle=l}(window);
//# sourceMappingURL=osc.min.map