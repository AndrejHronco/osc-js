/*! osc-js - v0.0.1 - 2014-03-16 by marmorkuchen.net */
!function(a){"use strict";function b(a){var b="";return"object"==typeof a?b="/"+a.join("/"):(b=a,b.length>1&&"/"===b[b.length-1]&&(b=b.slice(0,b.length-1))),b}function c(a){var b;return b=a.replace(/\./g,"\\."),b=b.replace(/\(/g,"\\("),b=b.replace(/\)/g,"\\)"),b=b.replace(/\{/g,"("),b=b.replace(/\}/g,")"),b=b.replace(/\,/g,"|"),b=b.replace(/\?/g,"."),b=b.replace(/\*/g,".*")}var d={SOCKET:{IS_NOT_INITALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3}},e=function(){return this.CALLBACKS_KEY="_cb",this._callbackHandlers={open:[],error:[],close:[]},this._addressHandlers={},this._uuid=-1,!0};e.prototype.on=function(a,c){var d,e,f;if("string"!=typeof a&&"object"!=typeof a||"function"!=typeof c)throw"OSCEventHandler Error: on expects string/array as eventName and function as callback";return d=(++this._uuid).toString(),f={token:d,callback:c},"string"==typeof a&&a in this._callbackHandlers?(this._callbackHandlers[a].push(f),d):(e=b(a),e in this._addressHandlers||(this._addressHandlers[e]=[]),this._addressHandlers[e].push(f),d)},e.prototype.off=function(a,c){var d,e,f;if("string"!=typeof a&&"object"!=typeof a||!c)throw"OSCEventHandler Error: off expects string/array as eventName and a proper token";return e=!1,"string"==typeof a&&this._callbackHandlers[a]?(f=this._callbackHandlers,d=a):(d=b(a),f=this._addressHandlers),d in f&&f[d].forEach(function(a,b){a.token===c&&(f[d].splice(b,1),e=!0)}),e},e.prototype.notify=function(a,d){var e,f,g,h;if("string"!=typeof a)throw"OSCEventHandler Error: notify expects a string";if(this._callbackHandlers[a])return this._callbackHandlers[a].forEach(function(a){a.callback(d)}),!0;if(0===a.length||"/"!==a[0])throw"OSCEventHandler Error: notify expects a proper address starting with /";return f=Object.keys(this._addressHandlers),e=this,f.forEach(function(f){g=new RegExp(c(b(a)),"g"),h=g.test(f),h&&f.length===g.lastIndex&&e._addressHandlers[f].forEach(function(a){a.callback(d)})}),!0};var f=function(){this._socket=null};f.prototype.server=function(a,b){if(!a||!b)throw"OSCSocket Error: missing WebSocket address or port";return this._socket=new WebSocket("ws://"+a+":"+b),this._socket.binaryType="arraybuffer",this._socket.onopen=function(a){h.notify("open",a)},this._socket.onerror=function(a){h.notify("error",a)},this._socket.onmessage=function(a){var b=new g;b.decode(a.data),h.notify(b.address,b.toJSON())},!0},f.prototype.status=function(){return this._socket?this._socket.readyState:d.SOCKET.IS_NOT_INITALIZED};var g=function(){return this.address="",this.typesString="",this.args=[],this.OSCString=function(){this.value="",this.offset=0},this.OSCString.prototype.decode=function(a,b){for(var c,d,e,f=new Int8Array(a),g=b;f[g]&&g<f.length;)g++;if(g===f.length)throw"OSCMessage Error: malformed not ending OSC String";for(d=f.subarray(b,g),e="",c=0;c<d.length;c++)e+=String.fromCharCode(d[c]);return this.offset=4*Math.ceil((g+1)/4),this.value=e,this.offset},this.OSCInt=function(){this.value=0,this.offset=0},this.OSCInt.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getInt32(0),this.offset=b+4,this.offset},this.OSCFloat=function(){this.value=0,this.offset=0},this.OSCFloat.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getFloat32(0),this.offset=b+4,this.offset},this.OSCBlob=function(){this.value=new Blob,this.offset=0},this.OSCBlob.prototype.decode=function(a,b){var c=new DataView(a,b,4),d=c.getInt32(0),e=a.slice(b+4,b+4+d);return this.value=new Blob([e]),this.offset=b+4+d,this.offset},!0};g.prototype.toJSON=function(){var a={address:this.address,types:this.typesString,arguments:this.args};return a},g.prototype.decode=function(a){var b,c,d,e,f;if(a.byteLength%4!==0)throw"OSCMessage Error: byteLength has to be a multiple of four";if(b=new this.OSCString,b.decode(a,0),c=new this.OSCString,c.decode(a,b.offset),0===c.length||","!==c.value[0])throw"OSCMessage Error: malformed or missing OSC TypeString";for(e=[],f=c.offset,d=1;d<c.value.length;d++){var g;if("i"===c.value[d])g=new this.OSCInt;else if("f"===c.value[d])g=new this.OSCFloat;else if("s"===c.value[d])g=new this.OSCString;else{if("b"!==c.value[d])throw"OSCMessage Error: found nonstandard argument type";g=new this.OSCBlob}g.decode(a,f),f=g.offset,e.push(g.value)}return this.address=b.value,this.typesString=c.value.slice(1,c.value.length),this.args=e,!0},g.prototype.encode=function(a,b){return console.log(a,b),!0};var h,i,j=function(){return this.SOCKET=d.SOCKET,h=new e,i=new f,this.__OSCEventHandler=e,this.__OSCSocket=f,this.__OSCMessage=g,!0};j.prototype.on=function(a,b){return h.on(a,b)},j.prototype.off=function(a,b){return h.off(a,b)},j.prototype.server=function(a,b){return i.server(a,b)},j.prototype.status=function(){return i.status()},a.OSC=j}(window);
//# sourceMappingURL=osc.min.map