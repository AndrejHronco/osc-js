/*! osc-js - v0.0.1 - 2014-03-10 by marmorkuchen.net */
!function(a){"use strict";function b(a){var b=a.split("/");return b=b.filter(function(a){return a.length>0})}var c={SOCKET:{IS_NOT_INITALIZED:-1,IS_CONNECTING:0,IS_OPEN:1,IS_CLOSING:2,IS_CLOSED:3}},d=function(){return this.CALLBACKS_KEY="_cb",this._callbackHandlers={onOpen:[],onError:[],onClose:[]},this._addressHandlers={},this._uuid=-1,!0};d.prototype.on=function(a,c){var d,e,f,g;if("string"!=typeof a&&"object"!=typeof a||"function"!=typeof c)throw"OSCEventHandler Error: on expects string/array as eventName and function as callback";if(d=(++this._uuid).toString(),f={token:d,callback:c},"string"==typeof a){if(this._callbackHandlers[a])return this._callbackHandlers[a].push(f),d;e=b(a)}else e=a;if("string"==typeof a&&(0===a.length||"/"!==a[0]))throw"OSCEventHandler Error: expects string to start with a / character";var h=this._addressHandlers;for(g=0;g<e.length;++g){var i=e[g];i in h||(h[i]={},h[i][this.CALLBACKS_KEY]=[]),h=h[i]}return this.CALLBACKS_KEY in h||(h[this.CALLBACKS_KEY]=[]),h[this.CALLBACKS_KEY].push(f),d},d.prototype.off=function(a,c){var d,e,f;if("string"!=typeof a&&"object"!=typeof a||!c)throw"OSCEventHandler Error: off expects string/array as eventName and a proper token";if(f=!1,"string"==typeof a){if(this._callbackHandlers[a]){for(e=0;e<this._callbackHandlers[a].length;e++)this._callbackHandlers[a][e].token===c&&(this._callbackHandlers[a].splice(e,1),f=!0);return f}d=b(a)}else d=a;var g=[],h=this._addressHandlers;for(e=0;e<d.length;++e)h=h&&d[e]in h?h[d[e]]:null;return h&&this.CALLBACKS_KEY in h&&(g=h[this.CALLBACKS_KEY]),g.some(function(a,b){return a.token===c?(g.splice(b,1),f=!0,!0):!1}),f},d.prototype.notify=function(a,c){var d,e;if("string"==typeof a){if(this._callbackHandlers[a])return this._callbackHandlers[a].forEach(function(a){a.callback(c)}),!0;d=b(a)}else d=a;var f=[],g=this._addressHandlers;this.CALLBACKS_KEY in g&&(f=f.concat(g[this.CALLBACKS_KEY]));for(e=0;e<d.length;e++)d[e]in g&&(g=g[d[e]],this.CALLBACKS_KEY in g&&(f=f.concat(g[this.CALLBACKS_KEY])));return f.forEach(function(a){a.callback(c)}),!0};var e=function(){this._socket=null};e.prototype.server=function(a,b){if(!a||!b)throw"OSCSocket Error: missing WebSocket address or port";return this._socket=new WebSocket("ws://"+a+":"+b),this._socket.binaryType="arraybuffer",this._socket.onopen=function(a){g.notify("onOpen",a)},this._socket.onerror=function(a){g.notify("onError",a)},this._socket.onmessage=function(a){var b=new f;b.decode(a.data),g.notify(b.address,b.toJSON())},!0},e.prototype.status=function(){return this._socket?this._socket.readyState:c.SOCKET.IS_NOT_INITALIZED};var f=function(){return this.address=[],this.addressString="",this.typesString="",this.args=[],this.OSCString=function(){this.value="",this.offset=0},this.OSCString.prototype.decode=function(a,b){for(var c=new Int8Array(a),d=b;c[d]&&d<c.length;)d++;if(d===c.length)throw"OSCMessage Error: malformed not ending OSC String";return this.value=String.fromCharCode.apply(null,c.subarray(b,d)),this.offset=parseInt(4*Math.ceil((d+1)/4),10),this.offset},this.OSCInt=function(){this.value=0,this.offset=0},this.OSCInt.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getInt32(0),this.offset=b+4,this.offset},this.OSCFloat=function(){this.value=0,this.offset=0},this.OSCFloat.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getFloat32(0),this.offset=b+4,this.offset},this.OSCBlob=function(){this.value=0,this.offset=0},this.OSCBlob.prototype.decode=function(a,b){var c=new DataView(a,b,4);return this.value=c.getFloat32(0),this.offset=b+4,this.offset},!0};f.prototype.toJSON=function(){var a={address:this.address,addressString:this.addressString,types:this.typesString,arguments:this.args};return a},f.prototype.decode=function(a){var c,d,e,f,g;if(c=new this.OSCString,c.decode(a,0),d=new this.OSCString,d.decode(a,c.offset),0===d.length||","!==d.value[0])throw"OSCMessage Error: malformed or missing OSC TypeString";for(f=[],g=d.offset,e=1;e<d.value.length;e++){var h;if("i"===d.value[e])h=new this.OSCInt;else if("f"===d.value[e])h=new this.OSCFloat;else if("s"===d.value[e])h=new this.OSCString;else{if("b"!==d.value[e])throw"OSCMessage Error: found nonstandard argument type";h=new this.OSCBlob}h.decode(a,g),g=h.offset,f.push(h.value)}return this.address=b(c.value),this.addressString=c.value,this.typesString=d.value.slice(1,d.value.length),this.args=f,!0},f.prototype.encode=function(a,b){return console.log(a,b),!0};var g,h,i,j=function(){return this.SOCKET=c.SOCKET,g=new d,h=new e,i=new f,this.__OSCEventHandler=g,this.__OSCSocket=h,this.__OSCMessage=i,!0};j.prototype.on=function(a,b){return g.on(a,b)},j.prototype.off=function(a,b){return g.off(a,b)},j.prototype.server=function(a,b){return h.server(a,b)},j.prototype.status=function(){return h.status()},a.OSC=j}(window);
//# sourceMappingURL=osc.min.map